/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-spdx",
factory: function (require) {
var plugin=(()=>{var $t=Object.create;var ee=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var Qt=Object.getOwnPropertyNames;var Jt=Object.getPrototypeOf,er=Object.prototype.hasOwnProperty;var f=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var p=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),te=(e,t)=>{for(var r in t)ee(e,r,{get:t[r],enumerable:!0})},Ye=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Qt(t))!er.call(e,i)&&i!==r&&ee(e,i,{get:()=>t[i],enumerable:!(n=Zt(t,i))||n.enumerable});return e};var Xe=(e,t,r)=>(r=e!=null?$t(Jt(e)):{},Ye(t||!e||!e.__esModule?ee(r,"default",{value:e,enumerable:!0}):r,e)),tr=e=>Ye(ee({},"__esModule",{value:!0}),e);var Te=p(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.default=ir;var rr=nr(f("crypto"));function nr(e){return e&&e.__esModule?e:{default:e}}var ne=new Uint8Array(256),re=ne.length;function ir(){return re>ne.length-16&&(rr.default.randomFillSync(ne),re=0),ne.slice(re,re+=16)}});var je=p(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.default=void 0;var sr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;ie.default=sr});var k=p(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.default=void 0;var ar=or(je());function or(e){return e&&e.__esModule?e:{default:e}}function cr(e){return typeof e=="string"&&ar.default.test(e)}var dr=cr;se.default=dr});var L=p(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.default=void 0;w.unsafeStringify=ze;var ur=lr(k());function lr(e){return e&&e.__esModule?e:{default:e}}var m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));function ze(e,t=0){return m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+"-"+m[e[t+4]]+m[e[t+5]]+"-"+m[e[t+6]]+m[e[t+7]]+"-"+m[e[t+8]]+m[e[t+9]]+"-"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]}function fr(e,t=0){let r=ze(e,t);if(!(0,ur.default)(r))throw TypeError("Stringified UUID is invalid");return r}var mr=fr;w.default=mr});var Ke=p(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.default=void 0;var pr=Dr(Te()),hr=L();function Dr(e){return e&&e.__esModule?e:{default:e}}var Ge,Ne,Ce=0,ke=0;function gr(e,t,r){let n=t&&r||0,i=t||new Array(16);e=e||{};let s=e.node||Ge,o=e.clockseq!==void 0?e.clockseq:Ne;if(s==null||o==null){let l=e.random||(e.rng||pr.default)();s==null&&(s=Ge=[l[0]|1,l[1],l[2],l[3],l[4],l[5]]),o==null&&(o=Ne=(l[6]<<8|l[7])&16383)}let a=e.msecs!==void 0?e.msecs:Date.now(),d=e.nsecs!==void 0?e.nsecs:ke+1,c=a-Ce+(d-ke)/1e4;if(c<0&&e.clockseq===void 0&&(o=o+1&16383),(c<0||a>Ce)&&e.nsecs===void 0&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Ce=a,ke=d,Ne=o,a+=122192928e5;let u=((a&268435455)*1e4+d)%4294967296;i[n++]=u>>>24&255,i[n++]=u>>>16&255,i[n++]=u>>>8&255,i[n++]=u&255;let D=a/4294967296*1e4&268435455;i[n++]=D>>>8&255,i[n++]=D&255,i[n++]=D>>>24&15|16,i[n++]=D>>>16&255,i[n++]=o>>>8|128,i[n++]=o&255;for(let l=0;l<6;++l)i[n+l]=s[l];return t||(0,hr.unsafeStringify)(i)}var Ir=gr;ae.default=Ir});var we=p(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.default=void 0;var Er=Pr(k());function Pr(e){return e&&e.__esModule?e:{default:e}}function xr(e){if(!(0,Er.default)(e))throw TypeError("Invalid UUID");let t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=t&255,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=t&255,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=t&255,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=t&255,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=t&255,r}var Sr=xr;oe.default=Sr});var Le=p(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.URL=v.DNS=void 0;v.default=Ar;var _r=L(),vr=yr(we());function yr(e){return e&&e.__esModule?e:{default:e}}function Or(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}var We="6ba7b810-9dad-11d1-80b4-00c04fd430c8";v.DNS=We;var $e="6ba7b811-9dad-11d1-80b4-00c04fd430c8";v.URL=$e;function Ar(e,t,r){function n(i,s,o,a){var d;if(typeof i=="string"&&(i=Or(i)),typeof s=="string"&&(s=(0,vr.default)(s)),((d=s)===null||d===void 0?void 0:d.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=r(c),c[6]=c[6]&15|t,c[8]=c[8]&63|128,o){a=a||0;for(let u=0;u<16;++u)o[a+u]=c[u];return o}return(0,_r.unsafeStringify)(c)}try{n.name=e}catch{}return n.DNS=We,n.URL=$e,n}});var Ze=p(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.default=void 0;var Tr=Nr(f("crypto"));function Nr(e){return e&&e.__esModule?e:{default:e}}function Cr(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),Tr.default.createHash("md5").update(e).digest()}var kr=Cr;ce.default=kr});var Je=p(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.default=void 0;var wr=Qe(Le()),Lr=Qe(Ze());function Qe(e){return e&&e.__esModule?e:{default:e}}var Rr=(0,wr.default)("v3",48,Lr.default),Fr=Rr;de.default=Fr});var et=p(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.default=void 0;var Mr=br(f("crypto"));function br(e){return e&&e.__esModule?e:{default:e}}var Ur={randomUUID:Mr.default.randomUUID};ue.default=Ur});var nt=p(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.default=void 0;var tt=rt(et()),Vr=rt(Te()),Hr=L();function rt(e){return e&&e.__esModule?e:{default:e}}function qr(e,t,r){if(tt.default.randomUUID&&!t&&!e)return tt.default.randomUUID();e=e||{};let n=e.random||(e.rng||Vr.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let i=0;i<16;++i)t[r+i]=n[i];return t}return(0,Hr.unsafeStringify)(n)}var Br=qr;le.default=Br});var it=p(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.default=void 0;var Yr=Xr(f("crypto"));function Xr(e){return e&&e.__esModule?e:{default:e}}function jr(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),Yr.default.createHash("sha1").update(e).digest()}var zr=jr;fe.default=zr});var at=p(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.default=void 0;var Gr=st(Le()),Kr=st(it());function st(e){return e&&e.__esModule?e:{default:e}}var Wr=(0,Gr.default)("v5",80,Kr.default),$r=Wr;me.default=$r});var ot=p(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.default=void 0;var Zr="00000000-0000-0000-0000-000000000000";pe.default=Zr});var ct=p(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.default=void 0;var Qr=Jr(k());function Jr(e){return e&&e.__esModule?e:{default:e}}function en(e){if(!(0,Qr.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}var tn=en;he.default=tn});var dt=p(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});Object.defineProperty(g,"NIL",{enumerable:!0,get:function(){return on.default}});Object.defineProperty(g,"parse",{enumerable:!0,get:function(){return ln.default}});Object.defineProperty(g,"stringify",{enumerable:!0,get:function(){return un.default}});Object.defineProperty(g,"v1",{enumerable:!0,get:function(){return rn.default}});Object.defineProperty(g,"v3",{enumerable:!0,get:function(){return nn.default}});Object.defineProperty(g,"v4",{enumerable:!0,get:function(){return sn.default}});Object.defineProperty(g,"v5",{enumerable:!0,get:function(){return an.default}});Object.defineProperty(g,"validate",{enumerable:!0,get:function(){return dn.default}});Object.defineProperty(g,"version",{enumerable:!0,get:function(){return cn.default}});var rn=x(Ke()),nn=x(Je()),sn=x(nt()),an=x(at()),on=x(ot()),cn=x(ct()),dn=x(k()),un=x(L()),ln=x(we());function x(e){return e&&e.__esModule?e:{default:e}}});var qn={};te(qn,{default:()=>Hn});var Ft=f("@yarnpkg/cli");var mt=Xe(f("fs/promises"),1);var E=Xe(dt(),1),si=E.default.v1,ai=E.default.v3,De=E.default.v4,oi=E.default.v5,ci=E.default.NIL,di=E.default.version,ui=E.default.validate,li=E.default.stringify,fi=E.default.parse;function ge(e){return e.toISOString().split(".")[0]+"Z"}var F=class{created;creators;comment;licenseListVersion;constructor(t,r,n,i){this.created=t,this.creators=r,this.comment=n,this.licenseListVersion=i}static fromDocument(t){return new F(ge(t.creationInfo.created),t.creationInfo.creators.map(r=>r.toString()),t.creationInfo.creatorComment??void 0,t.creationInfo.licenseListVersion??void 0)}},y=class{algorithm;checksumValue;constructor(t,r){this.algorithm=t,this.checksumValue=r}static fromChecksum(t){return new y(t.algorithm,t.value)}},M=class{packageVerificationCodeValue;packageVerificationCodeExcludedFiles;constructor(t,r){this.packageVerificationCodeValue=t,this.packageVerificationCodeExcludedFiles=r}static fromPackageVerificationCode(t){return new M(t.value,t.excludedFiles)}},b=class{comment;referenceCategory;referenceLocator;referenceType;constructor(t,r,n,i){this.referenceCategory=t,this.referenceLocator=r,this.referenceType=n,this.comment=i}static fromExternalPackageRef(t){return new b(t.category.toString(),t.locator,t.type,t.comment)}},U=class{name;downloadLocation;SPDXID;filesAnalyzed;packageVerificationCode;checksums;licenseInfoFromFiles;externalRefs;attributionTexts;builtDate;comment;copyrightText;description;homepage;licenseComments;licenseConcluded;licenseDeclared;originator;packageFileName;primaryPackagePurpose;releaseDate;sourceInfo;summary;supplier;validUntilDate;versionInfo;constructor(t,r,n,i,s,o,a,d,c,u,D,l,Oe,bt,Ut,Vt,Ht,qt,Bt,Yt,Xt,jt,zt,Gt,Kt,Wt){this.name=t,this.downloadLocation=r,this.SPDXID=n,this.filesAnalyzed=i,this.packageVerificationCode=s,this.checksums=o,this.licenseInfoFromFiles=a,this.externalRefs=d,this.attributionTexts=c,this.builtDate=u,this.comment=D,this.copyrightText=l,this.description=Oe,this.homepage=bt,this.licenseComments=Ut,this.licenseConcluded=Vt,this.licenseDeclared=Ht,this.originator=qt,this.packageFileName=Bt,this.primaryPackagePurpose=Yt,this.releaseDate=Xt,this.sourceInfo=jt,this.summary=zt,this.supplier=Gt,this.validUntilDate=Kt,this.versionInfo=Wt}static fromPackage(t){let r=t.checksums.length>0?t.checksums.map(s=>y.fromChecksum(s)):void 0,n=t.verificationCode?M.fromPackageVerificationCode(t.verificationCode):void 0,i=t.externalReferences?.length>0?t.externalReferences.map(s=>b.fromExternalPackageRef(s)):void 0;return new U(t.name,t.downloadLocation.toString(),t.spdxId,t.filesAnalyzed,n,r,t.licenseInfoFromFiles.map(s=>s.toString()),i,t.attributionTexts.length>0?t.attributionTexts:void 0,t.builtDate?ge(t.builtDate):void 0,t.comment,t.copyrightText?.toString(),t.description,t.homepage?.toString(),t.licenseComment,t.licenseConcluded?.toString(),t.licenseDeclared?.toString(),t.originator?.toString(),t.fileName,t.primaryPackagePurpose?.toString(),t.releaseDate?ge(t.releaseDate):void 0,t.sourceInfo,t.summary,t.supplier?.toString(),t.validUntilDate?ge(t.validUntilDate):void 0,t.version)}},V=class{spdxElementId;relatedSpdxElement;relationshipType;comment;constructor(t,r,n,i){this.spdxElementId=t,this.comment=i,this.relatedSpdxElement=r,this.relationshipType=n}static fromRelationship(t){return new V(t.spdxElementId,t.relatedSpdxElementId,t.relationshipType)}},H=class{checksum;externalDocumentId;spdxDocument;constructor(t,r,n){this.checksum=t,this.externalDocumentId=r,this.spdxDocument=n}static fromExternalDocumentRef(t){let r=y.fromChecksum(t.checksum);return new H(r,t.documentRefId,t.documentUri)}},q=class{SPDXID;fileName;checksums;attributionTexts;comment;copyrightText;fileContributors;fileTypes;licenseComments;licenseConcluded;licenseInfoInFiles;noticeText;constructor(t,r,n,i,s,o,a,d,c,u,D,l){this.SPDXID=t,this.fileName=r,this.checksums=n,this.attributionTexts=i,this.comment=s,this.copyrightText=o,this.fileContributors=a,this.fileTypes=d,this.licenseComments=c,this.licenseConcluded=u,this.licenseInfoInFiles=D,this.noticeText=l}static fromFile(t){let r=t.checksums.map(s=>y.fromChecksum(s)),n=t.fileTypes.length>0?t.fileTypes.map(s=>s.toString()):void 0,i=t.licenseInfoInFiles.length>0?t.licenseInfoInFiles.map(s=>s.toString()):void 0;return new q(t.spdxId,t.name,r,t.attributionTexts.length>0?t.attributionTexts:void 0,t.comment,t.copyrightText?.toString(),t.contributors.length>0?t.contributors:void 0,n,t.licenseComment,t.licenseConcluded?.toString(),i,t.notice)}},B=class{SPDXID;comment;creationInfo;dataLicense;externalDocumentRefs;name;spdxVersion;documentNamespace;packages;files;relationships;constructor(t,r,n,i,s,o,a,d,c,u,D){this.SPDXID=t,this.spdxVersion=r,this.name=n,this.documentNamespace=i,this.dataLicense=s,this.creationInfo=o,this.packages=a,this.files=d,this.relationships=c,this.externalDocumentRefs=u,this.comment=D}static fromDocument(t){let r=F.fromDocument(t),n=t.packages.length>0?t.packages.map(a=>U.fromPackage(a)):void 0,i=t.files.length>0?t.files.map(a=>q.fromFile(a)):void 0,s=t.relationships.length>0?t.relationships.map(a=>V.fromRelationship(a)):void 0,o=t.creationInfo.externalDocumentRefs?.length>0?t.creationInfo.externalDocumentRefs.map(a=>H.fromExternalDocumentRef(a)):void 0;return new B(t.creationInfo.spdxId,t.creationInfo.spdxVersion,t.creationInfo.name,t.creationInfo.documentNamespace,t.creationInfo.dataLicense,r,n,i,s,o,t.creationInfo.documentComment)}};function ut(e,t){return t.some(r=>e.has(r.spdxId)?!0:(e.add(r.spdxId),!1))}var Ie=class{creationInfo;packages;files;relationships;constructor(t,r){this.creationInfo=t,this.packages=r?.packages??[],this.files=r?.files??[],this.relationships=r?.relationships??[]}hasMissingDescribesRelationships(){let t=this.packages.length===1&&this.files.length===0,r=this.relationships.filter(i=>i.relationshipType==="DESCRIBES"),n=this.relationships.filter(i=>i.relationshipType==="DESCRIBED_BY");return!t&&r.length===0&&n.length===0}hasDuplicateSpdxIds(){let t=new Set([this.creationInfo.spdxId]);return ut(t,this.packages)||ut(t,this.files)}collectValidationIssues(){let t=[];return this.creationInfo.spdxVersion!=="SPDX-2.3"&&t.push("Invalid SPDX version. Currently only SPDX-2.3 is supported."),this.hasMissingDescribesRelationships()&&t.push(`Missing DESCRIBES or DESCRIBED_BY relationships.
Document must have at least one DESCRIBES and one DESCRIBED_BY relationship, if there is not exactly one package present.`),this.hasDuplicateSpdxIds()&&t.push("Duplicate SPDX IDs for document, packages or files."),t}async writeFile(t){let r=B.fromDocument(this),n=JSON.stringify(r,null,2);await mt.default.writeFile(t,n)}},T;(function(e){e.AMENDS="AMENDS",e.ANCESTOR_OF="ANCESTOR_OF",e.BUILD_DEPENDENCY_OF="BUILD_DEPENDENCY_OF",e.BUILD_TOOL_OF="BUILD_TOOL_OF",e.CONTAINED_BY="CONTAINED_BY",e.CONTAINS="CONTAINS",e.COPY_OF="COPY_OF",e.DATA_FILE_OF="DATA_FILE_OF",e.DEPENDENCY_MANIFEST_OF="DEPENDENCY_MANIFEST_OF",e.DEPENDENCY_OF="DEPENDENCY_OF",e.DEPENDS_ON="DEPENDS_ON",e.DESCENDANT_OF="DESCENDANT_OF",e.DESCRIBED_BY="DESCRIBED_BY",e.DESCRIBES="DESCRIBES",e.DEV_DEPENDENCY_OF="DEV_DEPENDENCY_OF",e.DEV_TOOL_OF="DEV_TOOL_OF",e.DISTRIBUTION_ARTIFACT="DISTRIBUTION_ARTIFACT",e.DOCUMENTATION_OF="DOCUMENTATION_OF",e.DYNAMIC_LINK="DYNAMIC_LINK",e.EXAMPLE_OF="EXAMPLE_OF",e.EXPANDED_FROM_ARCHIVE="EXPANDED_FROM_ARCHIVE",e.FILE_ADDED="FILE_ADDED",e.FILE_DELETED="FILE_DELETED",e.FILE_MODIFIED="FILE_MODIFIED",e.GENERATED_FROM="GENERATED_FROM",e.GENERATES="GENERATES",e.HAS_PREREQUISITE="HAS_PREREQUISITE",e.METAFILE_OF="METAFILE_OF",e.OPTIONAL_COMPONENT_OF="OPTIONAL_COMPONENT_OF",e.OPTIONAL_DEPENDENCY_OF="OPTIONAL_DEPENDENCY_OF",e.OTHER="OTHER",e.PACKAGE_OF="PACKAGE_OF",e.PATCH_APPLIED="PATCH_APPLIED",e.PATCH_FOR="PATCH_FOR",e.PREREQUISITE_FOR="PREREQUISITE_FOR",e.PROVIDED_DEPENDENCY_OF="PROVIDED_DEPENDENCY_OF",e.REQUIREMENT_DESCRIPTION_FOR="REQUIREMENT_DESCRIPTION_FOR",e.RUNTIME_DEPENDENCY_OF="RUNTIME_DEPENDENCY_OF",e.SPECIFICATION_FOR="SPECIFICATION_FOR",e.STATIC_LINK="STATIC_LINK",e.TEST_CASE_OF="TEST_CASE_OF",e.TEST_DEPENDENCY_OF="TEST_DEPENDENCY_OF",e.TEST_OF="TEST_OF",e.TEST_TOOL_OF="TEST_TOOL_OF",e.VARIANT_OF="VARIANT_OF"})(T||(T={}));function lt(e){return typeof e=="string"?e:e instanceof Ie?e.creationInfo.spdxId:e.spdxId}var Y=class{spdxElementId;relatedSpdxElementId;relationshipType;comment;constructor(t,r,n,i){this.spdxElementId=t,this.relatedSpdxElementId=r,this.relationshipType=n,this.comment=i?.comment}static fromApi(t,r,n,i){return new Y(lt(t),lt(r),n,{comment:i?.comment})}},R;(function(e){e.Person="Person",e.Organization="Organization",e.Tool="Tool"})(R||(R={}));var I=class{type;name;email;constructor(t,r,n){if(r===R.Tool&&n)throw new Error("Email must be undefined if actorType is Tool.");this.name=t,this.email=n??void 0,this.type=r}static fromSpdxActor(t){let r=R[t.type];if(!r)throw new Error("Invalid actor type: "+t.type);return new I(t.name,r,t.email)}static fromSpdxActors(t){return Array.isArray(t)?t.map(r=>I.fromSpdxActor(r)):[I.fromSpdxActor(t)]}static tools(){return new I("SPDX Tools TS",R.Tool)}toString(){return this.type.valueOf()+": "+this.name+(this.email?" ("+this.email+")":"")}},Re;(function(e){e.SHA1="SHA1",e.BLAKE3="BLAKE3",e["SHA3-384"]="SHA3-384",e.SHA256="SHA256",e.SHA384="SHA384",e["BLAKE2b-512"]="BLAKE2b-512",e["BLAKE2b-256"]="BLAKE2b-256",e["SHA3-512"]="SHA3-512",e.MD2="MD2",e.ADLER32="ADLER32",e.MD4="MD4",e["SHA3-256"]="SHA3-256",e["BLAKE2b-384"]="BLAKE2b-384",e.SHA512="SHA512",e.MD6="MD6",e.MD5="MD5",e.SHA224="SHA224"})(Re||(Re={}));var S=class{algorithm;value;constructor(t,r){this.algorithm=t,this.value=r}static fromSpdxChecksum(t){let r=Re[t.checksumAlgorithm];if(!r)throw new Error("Invalid checksum algorithm: "+t.checksumAlgorithm);return new S(r,t.checksumValue)}static fromSpdxChecksums(t){return Array.isArray(t)?t.map(r=>S.fromSpdxChecksum(r)):[S.fromSpdxChecksum(t)]}},Ee="NOASSERTION",pt="NONE",X=class{toString(){return Ee}},Fe=class{toString(){return pt}};function P(e,t){let r=n=>n;return e===Ee?new X:e===pt?new Fe:t?t(e):r(e)}function fn(e){if(!(e instanceof X))throw new Error(`Invalid entry: ${e.toString()} is not allowed.`)}var Me;(function(e){e.OTHER="OTHER",e["PERSISTENT-ID"]="PERSISTENT-ID",e.PERSISTENT_ID="PERSISTENT_ID",e.SECURITY="SECURITY",e["PACKAGE-MANAGER"]="PACKAGE-MANAGER",e.PACKAGE_MANAGER="PACKAGE_MANAGER"})(Me||(Me={}));var j=class{category;type;locator;comment;constructor(t,r,n,i){this.category=t,this.type=r,this.locator=n,this.comment=i}static fromSpdxExternalPackageRefs(t){return t.map(r=>{let n=Me[r.referenceCategory];if(!n)throw new Error("Invalid external package reference category: "+r.referenceCategory);return new j(n,r.referenceType,r.referenceLocator,r.comment)})}},be;(function(e){e.APPLICATION="APPLICATION",e.FRAMEWORK="FRAMEWORK",e.LIBRARY="LIBRARY",e.CONTAINER="CONTAINER",e.OPERATING_SYSTEM="OPERATING_SYSTEM",e.DEVICE="DEVICE",e.FIRMWARE="FIRMWARE",e.SOURCE="SOURCE",e.ARCHIVE="ARCHIVE",e.FILE="FILE",e.INSTALL="INSTALL",e.OTHER="OTHER"})(be||(be={}));function mn(e){let t=be[e];if(!t)throw new Error("Invalid package purpose: "+e);return t}function ft(e){if(e)if(typeof e=="string"){let t=P(e);return fn(t),t}else{let t=I.fromSpdxActor(e);return pn(t),t}else return}function pn(e){if(e.type!=="Organization"&&e.type!=="Person")throw new Error(`Invalid vendor type: ${e.type}`)}var z=class{name;downloadLocation;spdxId;version;fileName;supplier;originator;filesAnalyzed;verificationCode;checksums;homepage;sourceInfo;licenseConcluded;licenseInfoFromFiles;licenseDeclared;licenseComment;copyrightText;summary;description;comment;externalReferences;attributionTexts;primaryPackagePurpose;releaseDate;builtDate;validUntilDate;constructor(t,r){this.name=t,this.downloadLocation=r?.downloadLocation??new X,this.spdxId=r?.spdxId??"SPDXRef-"+De(),this.version=r?.version??void 0,this.fileName=r?.fileName??void 0,this.supplier=r?.supplier??void 0,this.originator=r?.originator??void 0,this.filesAnalyzed=r?.filesAnalyzed??!1,this.verificationCode=r?.verificationCode??void 0,this.checksums=r?.checksums??[],this.homepage=r?.homepage??void 0,this.sourceInfo=r?.sourceInfo??void 0,this.licenseConcluded=r?.licenseConcluded??void 0,this.licenseInfoFromFiles=r?.licenseInfoFromFiles??[],this.licenseDeclared=r?.licenseDeclared??void 0,this.licenseComment=r?.licenseComment??void 0,this.copyrightText=r?.copyrightText??void 0,this.summary=r?.summary??void 0,this.description=r?.description??void 0,this.comment=r?.comment??void 0,this.externalReferences=r?.externalReferences??[],this.attributionTexts=r?.attributionTexts??[],this.primaryPackagePurpose=r?.primaryPackagePurpose??void 0,this.releaseDate=r?.releaseDate??void 0,this.builtDate=r?.builtDate??void 0,this.validUntilDate=r?.validUntilDate??void 0}static fromApi(t,r){return new z(t,{spdxId:r?.spdxId,version:r?.version,fileName:r?.fileName,downloadLocation:r?.downloadLocation&&P(r.downloadLocation),supplier:ft(r?.supplier),originator:ft(r?.originator),filesAnalyzed:r?.filesAnalyzed,verificationCode:r?.verificationCode,checksums:r?.checksums&&S.fromSpdxChecksums(r.checksums),homepage:r?.homepage&&P(r.homepage),sourceInfo:r?.sourceInfo,licenseConcluded:r?.licenseConcluded&&P(r.licenseConcluded),licenseInfoFromFiles:r?.licenseInfoFromFiles?.map(n=>P(n)),licenseDeclared:r?.licenseDeclared&&P(r.licenseDeclared),licenseComment:r?.licenseComment,copyrightText:r?.copyrightText&&P(r.copyrightText),summary:r?.summary,description:r?.description,comment:r?.comment,externalReferences:r?.externalReferences&&j.fromSpdxExternalPackageRefs(r.externalReferences),attributionTexts:r?.attributionTexts,primaryPackagePurpose:r?.primaryPackagePurpose?mn(r.primaryPackagePurpose):void 0,releaseDate:r?.releaseDate,builtDate:r?.builtDate,validUntilDate:r?.validUntilDate})}},G=class{documentRefId;documentUri;checksum;constructor(t,r,n){if(!t.match(/^DocumentRef-[\da-zA-Z.+-]+$/))throw new Error(`DocumentRefId must only contain letters, numbers, ".", "-" and "+", and must start with "DocumentRef-, but is: ${t}.`);this.documentRefId=t,this.documentUri=r,this.checksum=n}static fromApi(t){return new G(t.documentRefId,t.documentUri,S.fromSpdxChecksum({checksumValue:t.checksumValue,checksumAlgorithm:t.checksumAlgorithm}))}};function hn(e){return`SPDX-${e??"2.3"}`}function Dn(e){return`urn:${e.replace(/^[^A-Za-z0-9]+/,"").replace(/[^A-Za-z0-9-]/g,"-")||"document"}:${De()}`}var K=class{spdxVersion;dataLicense="CC0-1.0";spdxId;name;documentNamespace;externalDocumentRefs;licenseListVersion;creators;created;creatorComment;documentComment;constructor(t,r,n,i,s){this.spdxVersion=t,this.name=r,this.documentNamespace=n,this.creators=i,this.created=s?.created??new Date,this.externalDocumentRefs=s?.externalDocumentRefs??[],this.creatorComment=s?.creatorComment??void 0,this.licenseListVersion=s?.licenseListVersion??void 0,this.documentComment=s?.documentComment??void 0,this.spdxId=s?.spdxId??"SPDXRef-DOCUMENT"}static fromApi(t,r){return new K(hn(r?.spdxVersion),t,r?.namespace??Dn(t),r?.creators?I.fromSpdxActors(r.creators).concat(I.tools()):[I.tools()],{...r,externalDocumentRefs:r?.externalDocumentRefs?r.externalDocumentRefs.map(n=>G.fromApi(n)):void 0})}},Ue;(function(e){e.OTHER="OTHER",e.DOCUMENTATION="DOCUMENTATION",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.ARCHIVE="ARCHIVE",e.SPDX="SPDX",e.APPLICATION="APPLICATION",e.SOURCE="SOURCE",e.BINARY="BINARY",e.TEXT="TEXT",e.AUDIO="AUDIO"})(Ue||(Ue={}));function gn(e){let t=Ue[e];if(!t)throw new Error("Invalid file type: "+e);return t}var W=class{name;spdxId;checksums;fileTypes;licenseConcluded;licenseInfoInFiles;licenseComment;copyrightText;comment;notice;contributors;attributionTexts;constructor(t,r,n){this.name=t,this.spdxId=n?.spdxId??"SPDXRef-"+De(),this.checksums=r,this.fileTypes=n?.fileTypes??[],this.licenseConcluded=n?.licenseConcluded??void 0,this.licenseInfoInFiles=n?.licenseInfoInFiles??[],this.licenseComment=n?.licenseComment??void 0,this.copyrightText=n?.copyrightText??void 0,this.comment=n?.comment??void 0,this.notice=n?.notice??void 0,this.contributors=n?.contributors??[],this.attributionTexts=n?.attributionTexts??[]}static fromApi(t,r,n){return new W(t,S.fromSpdxChecksums(r),{spdxId:n?.spdxId??void 0,fileTypes:n?.fileTypes?n.fileTypes.map(i=>gn(i)):void 0,licenseConcluded:n?.licenseConcluded&&P(n.licenseConcluded),licenseInfoInFiles:n?.licenseInfoInFiles?.map(i=>P(i)),licenseComment:n?.licenseComment??void 0,copyrightText:n?.copyrightText&&P(n.copyrightText),comment:n?.comment??void 0,notice:n?.notice??void 0,contributors:n?.contributors??[],attributionTexts:n?.attributionTexts??[]})}},$=class extends Ie{static createDocument(t,r){let n=K.fromApi(t,r);return new $(n)}addPackage(t,r){let n=z.fromApi(t,r);return this.packages.push(n),n}addFile(t,r,n){let i=W.fromApi(t,r,n);return this.files.push(i),i}addRelationship(t,r,n,i){let s=Y.fromApi(t,r,n,i);return this.relationships.push(s),this}validate(t=!0){let r=this.collectValidationIssues();if(r.length>0){let n="Document is invalid: "+r.join(`
`);if(!t)throw new Error(n);console.error(n)}else console.log("Document is valid")}async write(t,r=!1){this.validate(r),await this.writeFile(t)}writeSync(t,r=!1){this.validate(r),this.writeFile(t).then(()=>{console.log("Wrote SBOM successfully: "+t)}).catch(n=>{console.error("Error writing sample SBOM: "+n)})}};function In(e){return parseInt(e.split(".")[0])}function ht(e,t){let r=t?.spdxVersion;if(!r||In(r)===2)return $.createDocument(e,t);throw new Error("Unsupported SPDX version")}var Mt=f("clipanion");var h=f("@yarnpkg/core"),_t=f("@yarnpkg/cli");var Z={};te(Z,{_getYarnStateAliases:()=>Et,fs:()=>xn,getPackagePath:()=>En});var O=f("@yarnpkg/core"),gt=f("@yarnpkg/parsers"),_=f("@yarnpkg/fslib");var N=()=>({os:[process.platform],cpu:[process.arch],libc:[]});var En=async(e,t)=>{if(await Pn(e),!O.structUtils.isPackageCompatible(t,N()))return null;let r=O.structUtils.convertPackageToLocator(t),n=O.structUtils.stringifyLocator(r),i=Pe[n]||It[n];if(!i)return null;let s=i.locations[0];return s?_.ppath.join(e.cwd,s):e.cwd},Pe,It,Pn=async e=>{if(!Pe){let t=_.ppath.join(e.configuration.projectCwd,_.Filename.nodeModules,".yarn-state.yml");Pe=(0,gt.parseSyml)(await _.xfs.readFilePromise(t,"utf8")),It=Et(Pe)}},xn=_.xfs,Et=e=>Object.entries(e).reduce((t,[r,n])=>{if(!n.aliases)return t;let i=O.structUtils.parseLocator(r);for(let s of n.aliases){let o=O.structUtils.makeLocator(i,s),a=O.structUtils.stringifyLocator(o);t[a]=n}return t},{});var Ve={};te(Ve,{fs:()=>_n,getPackagePath:()=>Sn});var Q=f("@yarnpkg/core"),A=f("@yarnpkg/fslib");var Sn=async(e,t)=>{if(!Q.structUtils.isPackageCompatible(t,N()))return null;let r=Q.structUtils.convertPackageToLocator(t),n=Q.structUtils.slugifyLocator(r),i=Q.structUtils.stringifyIdent(r),s=e.tryWorkspaceByLocator(r);return s?s.cwd:A.ppath.join(e.configuration.projectCwd,A.Filename.nodeModules,".store",n,A.Filename.nodeModules,i)},_n=A.xfs;var qe={};te(qe,{fs:()=>Se,getFs:()=>On,getPackagePath:()=>vn});var Pt=f("@yarnpkg/plugin-pnp"),xe=f("@yarnpkg/core"),xt=f("@yarnpkg/fslib"),_e=f("@yarnpkg/libzip");var vn=async(e,t)=>{if(yn(e),!xe.structUtils.isPackageCompatible(t,N()))return null;let r=xe.structUtils.convertPackageToLocator(t),n={name:xe.structUtils.stringifyIdent(r),reference:r.reference},i=He.getPackageInformation(n);if(!i)return null;let{packageLocation:s}=i;return s},He,yn=e=>{He||(He=module.require((0,Pt.getPnpPath)(e).cjs))},On=()=>(An(),Se),Se,An=()=>{Se||(Se=new xt.VirtualFS({baseFs:new _e.ZipOpenFS({libzip:(0,_e.getLibzipSync)(),readOnlyArchives:!0})}))};var St=e=>{switch(e){case"pnp":return qe;case"node-modules":return Z;case"pnpm":return Ve;default:throw new Error("Unsupported linker")}};async function vt(e){let t=await h.Configuration.find(e.context.cwd,e.context.plugins),{project:r,workspace:n}=await h.Project.find(t,e.context.cwd);if(!n)throw new _t.WorkspaceRequiredError(r.cwd,e.context.cwd);return await r.restoreInstallState(),[r,n]}function yt(e){let t=e.configuration.get("nodeLinker"),r;return typeof t=="string"?r=St(t):r=Z,r}var Ot=e=>{let t=new Set;for(let r of e.workspaces)r.manifest.devDependencies.forEach((n,i)=>{t.add(i)});return t},At=async e=>{for(let n of e.workspaces)n.manifest.devDependencies.clear();let t=await h.Cache.find(e.configuration),r=new h.ThrowReport;await e.resolveEverything({report:r,cache:t})},Be=async e=>{let t=new Map,r=e.storedDescriptors.values(),n=h.miscUtils.sortMap(r,[s=>h.structUtils.stringifyIdent(s),s=>h.structUtils.isVirtualDescriptor(s)?"0":"1",s=>s.range]),i=new Set;for(let s of n.values()){let o=e.storedResolutions.get(s.descriptorHash);if(!o)continue;let a=e.storedPackages.get(o);if(!a)continue;let{descriptorHash:d}=h.structUtils.isVirtualDescriptor(s)?h.structUtils.devirtualizeDescriptor(s):s;i.has(d)||(i.add(d),t.set(s,a))}return t};var ve=f("@yarnpkg/fslib");var Tn="SPDXRef-",Tt="(http:\\/\\/www\\.|https:\\/\\/www\\.|http:\\/\\/|https:\\/\\/|ssh:\\/\\/|git:\\/\\/|svn:\\/\\/|sftp:\\/\\/|ftp:\\/\\/)?([\\w\\-.!~*'()%;:&=+$,]+@)?[a-z0-9]+([\\-\\.]{1}[a-z0-9]+){0,100}\\.[a-z]{2,5}(:[0-9]{1,5})?(\\/.*)?",Nn="(git|hg|svn|bzr)",Cn="(git\\+git@[a-zA-Z0-9\\.\\-]+:[a-zA-Z0-9/\\\\.@\\-]+)",kn="(bzr\\+lp:[a-zA-Z0-9\\.\\-]+)",wn="^((("+Nn+"\\+)?"+Tt+")|"+Cn+"|"+kn+")$",Ln=new RegExp(Tt),Rn=new RegExp(wn);function Fn(e){return e&&typeof e=="object"&&Mn(e.url)?e.url:e&&typeof e=="object"?void 0:Ee}function Mn(e){return Ln.test(e)&&Rn.test(e)}function J(e){let t=e.name.replace(/^@/,"").replace(/_/g,"-"),r=e.version.replace(/\//g,".").replace(/_/g,"-");return Tn+t+"-"+r}async function ye(e,t,r,n,i){for(let[,s]of e.entries()){if(!s)continue;let o=await n.getPackagePath(r,s);if(o===null)continue;let a=JSON.parse(await n.fs.readFilePromise(ve.ppath.join(o,ve.Filename.manifest),"utf8")),{repository:d}=a,c=Fn(d),u=J(s);i.has(u)||(i.add(u),t.addPackage(s.name,{...c!==void 0&&{downloadLocation:c},spdxId:u}))}}function Nt(e,t,r){for(let[,n]of e.entries()){let i=J(n);r.has(i)&&t.addRelationship(t,i,T.DESCRIBES)}}function Ct(e,t,r,n,i){for(let[,s]of e.entries()){let o=J(s);for(let[a,d]of s.dependencies.entries()){if(!i.has(a))continue;let c=wt(r,d);!c||!n.has(c)||!n.has(o)||t.addRelationship(c,o,T.DEV_DEPENDENCY_OF)}}}function kt(e,t,r,n){for(let[,i]of e.entries()){let s=J(i);for(let[,o]of i.dependencies.entries()){let a=wt(r,o);!a||!n.has(a)||!n.has(s)||t.addRelationship(s,a,T.DEPENDS_ON)}}}function wt(e,t){let r=e.storedResolutions.get(t.descriptorHash);if(!r)return;let n=e.storedPackages.get(r);if(!!n)return J(n)}function Lt(e,t){let r=new Map;for(let[n,i]of e.entries())bn(t,n)&&r.set(n,i);return r}function bn(e,t){return!e.includes(t.identHash)}function Rt(e,t,r){let n=new Map;for(let[,i]of e.entries())for(let[s,o]of i.dependencies.entries())r.has(s)&&n.set(o,t.get(o));return n}var Un=".spdx.json",C=class extends Ft.BaseCommand{async execute(){let[t,r]=await vt(this),n=yt(t),i=ht(r.manifest.name?.name??"spdx"),s=new Set,o=Ot(t),a=await Be(t),d=[...a].flatMap(([,l])=>[...l.dependencies].flatMap(([,Oe])=>Oe.identHash)),c=Lt(a,d),u=Rt(c,a,o);await ye(c,i,t,n,s),Nt(c,i,s),await ye(u,i,t,n,s),Ct(c,i,t,s,o),await At(t);let D=await Be(t);await ye(D,i,t,n,s),kt(D,i,t,s),i.writeSync((r.manifest.name?.name??"")+Un)}};C.paths=[["spdx"]],C.usage=Mt.Command.Usage({description:"Generate SPDX document for the project",details:`
        This command generates an SPDX document for the project. The document will be placed in the root of the project.`,examples:[["Generate SPDX document","$0 spdx"]]});var Vn={commands:[C]},Hn=Vn;return tr(qn);})();
return plugin;
}
};
