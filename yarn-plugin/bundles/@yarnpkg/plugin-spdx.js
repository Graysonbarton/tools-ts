/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-spdx",
factory: function (require) {
var plugin=(()=>{var Ut=Object.create;var de=Object.defineProperty;var Vt=Object.getOwnPropertyDescriptor;var Ht=Object.getOwnPropertyNames;var qt=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty;var g=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var D=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),le=(t,e)=>{for(var r in e)de(t,r,{get:e[r],enumerable:!0})},Ye=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ht(e))!Bt.call(t,i)&&i!==r&&de(t,i,{get:()=>e[i],enumerable:!(n=Vt(e,i))||n.enumerable});return t};var Je=(t,e,r)=>(r=t!=null?Ut(qt(t)):{},Ye(e||!t||!t.__esModule?de(r,"default",{value:t,enumerable:!0}):r,t)),Yt=t=>Ye(de({},"__esModule",{value:!0}),t);var Te=D(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.default=zt;var Jt=Xt(g("crypto"));function Xt(t){return t&&t.__esModule?t:{default:t}}var fe=new Uint8Array(256),ue=fe.length;function zt(){return ue>fe.length-16&&(Jt.default.randomFillSync(fe),ue=0),fe.slice(ue,ue+=16)}});var Ze=D(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.default=void 0;var jt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;me.default=jt});var ie=D(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.default=void 0;var Gt=Kt(Ze());function Kt(t){return t&&t.__esModule?t:{default:t}}function Wt(t){return typeof t=="string"&&Gt.default.test(t)}var Qt=Wt;pe.default=Qt});var oe=D(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.default=void 0;se.unsafeStringify=$e;var Zt=$t(ie());function $t(t){return t&&t.__esModule?t:{default:t}}var x=[];for(let t=0;t<256;++t)x.push((t+256).toString(16).slice(1));function $e(t,e=0){return x[t[e+0]]+x[t[e+1]]+x[t[e+2]]+x[t[e+3]]+"-"+x[t[e+4]]+x[t[e+5]]+"-"+x[t[e+6]]+x[t[e+7]]+"-"+x[t[e+8]]+x[t[e+9]]+"-"+x[t[e+10]]+x[t[e+11]]+x[t[e+12]]+x[t[e+13]]+x[t[e+14]]+x[t[e+15]]}function er(t,e=0){let r=$e(t,e);if(!(0,Zt.default)(r))throw TypeError("Stringified UUID is invalid");return r}var tr=er;se.default=tr});var tt=D(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.default=void 0;var rr=ir(Te()),nr=oe();function ir(t){return t&&t.__esModule?t:{default:t}}var et,Fe,Le=0,we=0;function sr(t,e,r){let n=e&&r||0,i=e||new Array(16);t=t||{};let o=t.node||et,s=t.clockseq!==void 0?t.clockseq:Fe;if(o==null||s==null){let d=t.random||(t.rng||rr.default)();o==null&&(o=et=[d[0]|1,d[1],d[2],d[3],d[4],d[5]]),s==null&&(s=Fe=(d[6]<<8|d[7])&16383)}let a=t.msecs!==void 0?t.msecs:Date.now(),u=t.nsecs!==void 0?t.nsecs:we+1,l=a-Le+(u-we)/1e4;if(l<0&&t.clockseq===void 0&&(s=s+1&16383),(l<0||a>Le)&&t.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Le=a,we=u,Fe=s,a+=122192928e5;let h=((a&268435455)*1e4+u)%4294967296;i[n++]=h>>>24&255,i[n++]=h>>>16&255,i[n++]=h>>>8&255,i[n++]=h&255;let c=a/4294967296*1e4&268435455;i[n++]=c>>>8&255,i[n++]=c&255,i[n++]=c>>>24&15|16,i[n++]=c>>>16&255,i[n++]=s>>>8|128,i[n++]=s&255;for(let d=0;d<6;++d)i[n+d]=o[d];return e||(0,nr.unsafeStringify)(i)}var or=sr;ge.default=or});var Me=D(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.default=void 0;var ar=cr(ie());function cr(t){return t&&t.__esModule?t:{default:t}}function dr(t){if(!(0,ar.default)(t))throw TypeError("Invalid UUID");let e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}var lr=dr;he.default=lr});var be=D(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.URL=F.DNS=void 0;F.default=gr;var ur=oe(),fr=mr(Me());function mr(t){return t&&t.__esModule?t:{default:t}}function pr(t){t=unescape(encodeURIComponent(t));let e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}var rt="6ba7b810-9dad-11d1-80b4-00c04fd430c8";F.DNS=rt;var nt="6ba7b811-9dad-11d1-80b4-00c04fd430c8";F.URL=nt;function gr(t,e,r){function n(i,o,s,a){var u;if(typeof i=="string"&&(i=pr(i)),typeof o=="string"&&(o=(0,fr.default)(o)),((u=o)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let l=new Uint8Array(16+i.length);if(l.set(o),l.set(i,o.length),l=r(l),l[6]=l[6]&15|e,l[8]=l[8]&63|128,s){a=a||0;for(let h=0;h<16;++h)s[a+h]=l[h];return s}return(0,ur.unsafeStringify)(l)}try{n.name=t}catch{}return n.DNS=rt,n.URL=nt,n}});var it=D(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.default=void 0;var hr=xr(g("crypto"));function xr(t){return t&&t.__esModule?t:{default:t}}function Dr(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),hr.default.createHash("md5").update(t).digest()}var Ir=Dr;xe.default=Ir});var ot=D(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.default=void 0;var Pr=st(be()),Er=st(it());function st(t){return t&&t.__esModule?t:{default:t}}var Sr=(0,Pr.default)("v3",48,Er.default),kr=Sr;De.default=kr});var at=D(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.default=void 0;var Ar=yr(g("crypto"));function yr(t){return t&&t.__esModule?t:{default:t}}var Cr={randomUUID:Ar.default.randomUUID};Ie.default=Cr});var lt=D(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.default=void 0;var ct=dt(at()),_r=dt(Te()),Nr=oe();function dt(t){return t&&t.__esModule?t:{default:t}}function Or(t,e,r){if(ct.default.randomUUID&&!e&&!t)return ct.default.randomUUID();t=t||{};let n=t.random||(t.rng||_r.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let i=0;i<16;++i)e[r+i]=n[i];return e}return(0,Nr.unsafeStringify)(n)}var vr=Or;Pe.default=vr});var ut=D(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.default=void 0;var Rr=Tr(g("crypto"));function Tr(t){return t&&t.__esModule?t:{default:t}}function Fr(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),Rr.default.createHash("sha1").update(t).digest()}var Lr=Fr;Ee.default=Lr});var mt=D(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.default=void 0;var wr=ft(be()),Mr=ft(ut());function ft(t){return t&&t.__esModule?t:{default:t}}var br=(0,wr.default)("v5",80,Mr.default),Ur=br;Se.default=Ur});var pt=D(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.default=void 0;var Vr="00000000-0000-0000-0000-000000000000";ke.default=Vr});var gt=D(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.default=void 0;var Hr=qr(ie());function qr(t){return t&&t.__esModule?t:{default:t}}function Br(t){if(!(0,Hr.default)(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)}var Yr=Br;Ae.default=Yr});var ht=D(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});Object.defineProperty(y,"NIL",{enumerable:!0,get:function(){return Gr.default}});Object.defineProperty(y,"parse",{enumerable:!0,get:function(){return Zr.default}});Object.defineProperty(y,"stringify",{enumerable:!0,get:function(){return Qr.default}});Object.defineProperty(y,"v1",{enumerable:!0,get:function(){return Jr.default}});Object.defineProperty(y,"v3",{enumerable:!0,get:function(){return Xr.default}});Object.defineProperty(y,"v4",{enumerable:!0,get:function(){return zr.default}});Object.defineProperty(y,"v5",{enumerable:!0,get:function(){return jr.default}});Object.defineProperty(y,"validate",{enumerable:!0,get:function(){return Wr.default}});Object.defineProperty(y,"version",{enumerable:!0,get:function(){return Kr.default}});var Jr=v(tt()),Xr=v(ot()),zr=v(lt()),jr=v(mt()),Gr=v(pt()),Kr=v(gt()),Wr=v(ie()),Qr=v(oe()),Zr=v(Me());function v(t){return t&&t.__esModule?t:{default:t}}});var On={};le(On,{default:()=>Nn});var _e=g("@yarnpkg/cli"),Ne=g("@yarnpkg/core");function M(t){return t.toISOString().split(".")[0]+"Z"}var b=class{created;creators;comment;licenseListVersion;constructor(e,r,n,i){this.created=e,this.creators=r,this.comment=n,this.licenseListVersion=i}static fromDocument(e){return new b(M(e.creationInfo.created),e.creationInfo.creators.map(r=>r.toString()),e.creationInfo.creatorComment??void 0,e.creationInfo.licenseListVersion??void 0)}};var _=class{algorithm;checksumValue;constructor(e,r){this.algorithm=e,this.checksumValue=r}static fromChecksum(e){return new _(e.algorithm,e.value)}};var U=class{packageVerificationCodeValue;packageVerificationCodeExcludedFiles;constructor(e,r){this.packageVerificationCodeValue=e,this.packageVerificationCodeExcludedFiles=r}static fromPackageVerificationCode(e){return new U(e.value,e.excludedFiles)}};var V=class{comment;referenceCategory;referenceLocator;referenceType;constructor(e,r,n,i){this.referenceCategory=e,this.referenceLocator=r,this.referenceType=n,this.comment=i}static fromExternalPackageRef(e){return new V(e.category.toString(),e.locator,e.type,e.comment)}};var H=class{name;downloadLocation;SPDXID;filesAnalyzed;packageVerificationCode;checksums;licenseInfoFromFiles;externalRefs;attributionTexts;builtDate;comment;copyrightText;description;homepage;licenseComments;licenseConcluded;licenseDeclared;originator;packageFileName;primaryPackagePurpose;releaseDate;sourceInfo;summary;supplier;validUntilDate;versionInfo;constructor(e,r,n,i,o,s,a,u,l,h,c,d,ne,Oe,f,p,I,A,P,m,Tt,Ft,Lt,wt,Mt,bt){this.name=e,this.downloadLocation=r,this.SPDXID=n,this.filesAnalyzed=i,this.packageVerificationCode=o,this.checksums=s,this.licenseInfoFromFiles=a,this.externalRefs=u,this.attributionTexts=l,this.builtDate=h,this.comment=c,this.copyrightText=d,this.description=ne,this.homepage=Oe,this.licenseComments=f,this.licenseConcluded=p,this.licenseDeclared=I,this.originator=A,this.packageFileName=P,this.primaryPackagePurpose=m,this.releaseDate=Tt,this.sourceInfo=Ft,this.summary=Lt,this.supplier=wt,this.validUntilDate=Mt,this.versionInfo=bt}static fromPackage(e){let r=e.checksums.length>0?e.checksums.map(o=>_.fromChecksum(o)):void 0,n=e.verificationCode?U.fromPackageVerificationCode(e.verificationCode):void 0,i=e.externalReferences?.length>0?e.externalReferences.map(o=>V.fromExternalPackageRef(o)):void 0;return new H(e.name,e.downloadLocation.toString(),e.spdxId,e.filesAnalyzed,n,r,e.licenseInfoFromFiles.map(o=>o.toString()),i,e.attributionTexts.length>0?e.attributionTexts:void 0,e.builtDate?M(e.builtDate):void 0,e.comment,e.copyrightText?.toString(),e.description,e.homepage?.toString(),e.licenseComment,e.licenseConcluded?.toString(),e.licenseDeclared?.toString(),e.originator?.toString(),e.fileName,e.primaryPackagePurpose?.toString(),e.releaseDate?M(e.releaseDate):void 0,e.sourceInfo,e.summary,e.supplier?.toString(),e.validUntilDate?M(e.validUntilDate):void 0,e.version)}};var q=class{spdxElementId;relatedSpdxElement;relationshipType;comment;constructor(e,r,n,i){this.spdxElementId=e,this.comment=i,this.relatedSpdxElement=r,this.relationshipType=n}static fromRelationship(e){return new q(e.spdxElementId,e.relatedSpdxElementId,e.relationshipType)}};var B=class{checksum;externalDocumentId;spdxDocument;constructor(e,r,n){this.checksum=e,this.externalDocumentId=r,this.spdxDocument=n}static fromExternalDocumentRef(e){let r=_.fromChecksum(e.checksum);return new B(r,e.documentRefId,e.documentUri)}};var Y=class{SPDXID;fileName;checksums;attributionTexts;comment;copyrightText;fileContributors;fileTypes;licenseComments;licenseConcluded;licenseInfoInFiles;noticeText;constructor(e,r,n,i,o,s,a,u,l,h,c,d){this.SPDXID=e,this.fileName=r,this.checksums=n,this.attributionTexts=i,this.comment=o,this.copyrightText=s,this.fileContributors=a,this.fileTypes=u,this.licenseComments=l,this.licenseConcluded=h,this.licenseInfoInFiles=c,this.noticeText=d}static fromFile(e){let r=e.checksums.map(o=>_.fromChecksum(o)),n=e.fileTypes.length>0?e.fileTypes.map(o=>o.toString()):void 0,i=e.licenseInfoInFiles.length>0?e.licenseInfoInFiles.map(o=>o.toString()):void 0;return new Y(e.spdxId,e.name,r,e.attributionTexts.length>0?e.attributionTexts:void 0,e.comment,e.copyrightText?.toString(),e.contributors.length>0?e.contributors:void 0,n,e.licenseComment,e.licenseConcluded?.toString(),i,e.notice)}};var J=class{SPDXID;comment;creationInfo;dataLicense;externalDocumentRefs;name;spdxVersion;documentNamespace;packages;files;relationships;constructor(e,r,n,i,o,s,a,u,l,h,c){this.SPDXID=e,this.spdxVersion=r,this.name=n,this.documentNamespace=i,this.dataLicense=o,this.creationInfo=s,this.packages=a,this.files=u,this.relationships=l,this.externalDocumentRefs=h,this.comment=c}static fromDocument(e){let r=b.fromDocument(e),n=e.packages.length>0?e.packages.map(a=>H.fromPackage(a)):void 0,i=e.files.length>0?e.files.map(a=>Y.fromFile(a)):void 0,o=e.relationships.length>0?e.relationships.map(a=>q.fromRelationship(a)):void 0,s=e.creationInfo.externalDocumentRefs?.length>0?e.creationInfo.externalDocumentRefs.map(a=>B.fromExternalDocumentRef(a)):void 0;return new J(e.creationInfo.spdxId,e.creationInfo.spdxVersion,e.creationInfo.name,e.creationInfo.documentNamespace,e.creationInfo.dataLicense,r,n,i,o,s,e.creationInfo.documentComment)}};var Xe=Je(g("fs/promises"),1),X=class{creationInfo;packages;files;snippets;annotations;relationships;otherLicensingInfo;constructor(e,r){this.creationInfo=e,this.packages=r?.packages??[],this.files=r?.files??[],this.snippets=r?.snippets??[],this.annotations=r?.annotations??[],this.relationships=r?.relationships??[],this.otherLicensingInfo=r?.otherLicensingInfo??[]}hasMissingDescribesRelationships(){let e=this.packages.length===1&&this.files.length===0&&this.snippets.length===0,r=this.relationships.filter(i=>i.relationshipType==="DESCRIBES"),n=this.relationships.filter(i=>i.relationshipType==="DESCRIBED_BY");return!(e||r.length>0||n.length>0)}hasDuplicateSpdxIds(){let e=[];return this.packages.forEach(r=>{if(e.includes(r.spdxId))return!0;e.push(r.spdxId)}),this.relationships.forEach(r=>{if(e.includes(r.spdxElementId))return!0;e.push(r.spdxElementId)}),!1}gatherValidationIssues(){let e=[];return this.creationInfo.spdxVersion!=="SPDX-2.3"&&e.concat("Invalid SPDX version. Currently only SPDX-2.3 is supported."),this.hasMissingDescribesRelationships()&&e.concat("Missing DESCRIBES or DESCRIBED_BY relationships.","Document must have at least one DESCRIBES and one DESCRIBED_BY relationship, if there is not exactly one package present."),this.hasDuplicateSpdxIds()&&e.concat("Duplicate SPDX IDs for packages, files, snippets or relationships."),e}async writeFile(e){let r=J.fromDocument(this),n=JSON.stringify(r,null,2);await Xe.default.writeFile(e,n)}};function ze(t){return typeof t=="string"?t:t instanceof X?t.creationInfo.spdxId:t.spdxId}var z=class{spdxElementId;relatedSpdxElementId;relationshipType;comment;constructor(e,r,n,i){this.spdxElementId=e,this.relatedSpdxElementId=r,this.relationshipType=n,this.comment=i?.comment}static fromApi(e,r,n,i){return new z(ze(e),ze(r),n,{comment:i?.comment})}};var je=(n=>(n.Person="Person",n.Organization="Organization",n.Tool="Tool",n))(je||{}),E=class{type;name;email;constructor(e,r,n){this.name=e,this.email=n??void 0,this.type=r}static fromSpdxActor(e){let r=je[e.type];if(!r)throw new Error("Invalid actor type: "+e.type);return new E(e.name,r,e.email)}static fromSpdxActors(e){return Array.isArray(e)?e.map(r=>E.fromSpdxActor(r)):[E.fromSpdxActor(e)]}static tools(){return new E("SPDX Tools TS","Tool")}toString(){return this.type.valueOf()+": "+this.name+(this.email?" ("+this.email+")":"")}};var Ge=(c=>(c.SHA1="SHA1",c.BLAKE3="BLAKE3",c["SHA3-384"]="SHA3-384",c.SHA256="SHA256",c.SHA384="SHA384",c["BLAKE2b-512"]="BLAKE2b-512",c["BLAKE2b-256"]="BLAKE2b-256",c["SHA3-512"]="SHA3-512",c.MD2="MD2",c.ADLER32="ADLER32",c.MD4="MD4",c["SHA3-256"]="SHA3-256",c["BLAKE2b-384"]="BLAKE2b-384",c.SHA512="SHA512",c.MD6="MD6",c.MD5="MD5",c.SHA224="SHA224",c))(Ge||{}),S=class{algorithm;value;constructor(e,r){this.algorithm=e,this.value=r}static fromSpdxChecksum(e){let r=Ge[e.checksumAlgorithm];if(!r)throw new Error("Invalid checksum algorithm: "+e.checksumAlgorithm);return new S(r,e.checksumValue)}static fromSpdxChecksums(e){return Array.isArray(e)?e.map(r=>S.fromSpdxChecksum(r)):[S.fromSpdxChecksum(e)]}};var Ke="NOASSERTION",We="NONE",j=class{toString(){return Ke}},ve=class{toString(){return We}};function k(t,e){let r=n=>n;return t===Ke?new j:t===We?new ve:e?e(t):r(t)}function Qe(t){if(!(t instanceof j||typeof t=="string"))throw new Error(`Invalid entry: ${t.toString()} is not allowed.`)}var N=Je(ht(),1),Si=N.default.v1,ki=N.default.v3,G=N.default.v4,Ai=N.default.v5,yi=N.default.NIL,Ci=N.default.version,_i=N.default.validate,Ni=N.default.stringify,Oi=N.default.parse;var xt=(i=>(i.OTHER="OTHER",i["PERSISTENT-ID"]="PERSISTENT-ID",i.PERSISTENT_ID="PERSISTENT_ID",i.SECURITY="SECURITY",i["PACKAGE-MANAGER"]="PACKAGE-MANAGER",i.PACKAGE_MANAGER="PACKAGE_MANAGER",i))(xt||{}),K=class{category;type;locator;comment;constructor(e,r,n,i){this.category=e,this.type=r,this.locator=n,this.comment=i}static fromSpdxExternalPackageRefs(e){return e.map(r=>{let n=xt[r.referenceCategory];if(!n)throw new Error("Invalid external package reference category: "+r.referenceCategory);return new K(n,r.referenceType,r.referenceLocator,r.comment)})}};var It=(d=>(d.APPLICATION="APPLICATION",d.FRAMEWORK="FRAMEWORK",d.LIBRARY="LIBRARY",d.CONTAINER="CONTAINER",d.OPERATING_SYSTEM="OPERATING_SYSTEM",d.DEVICE="DEVICE",d.FIRMWARE="FIRMWARE",d.SOURCE="SOURCE",d.ARCHIVE="ARCHIVE",d.FILE="FILE",d.INSTALL="INSTALL",d.OTHER="OTHER",d))(It||{});function $r(t){let e=It[t];if(!e)throw new Error("Invalid package purpose: "+t);return e}function Dt(t){if(t)if(typeof t=="string"){let e=k(t);return Qe(e),e}else return E.fromSpdxActor(t);else return}var W=class{name;downloadLocation;spdxId;version;fileName;supplier;originator;filesAnalyzed;verificationCode;checksums;homepage;sourceInfo;licenseConcluded;licenseInfoFromFiles;licenseDeclared;licenseComment;copyrightText;summary;description;comment;externalReferences;attributionTexts;primaryPackagePurpose;releaseDate;builtDate;validUntilDate;constructor(e,r){this.name=e,this.downloadLocation=r?.downloadLocation??new j,this.spdxId=r?.spdxId??"SPDXRef-"+G(),this.version=r?.version??void 0,this.fileName=r?.fileName??void 0,this.supplier=r?.supplier??void 0,this.originator=r?.originator??void 0,this.filesAnalyzed=r?.filesAnalyzed??!1,this.verificationCode=r?.verificationCode??void 0,this.checksums=r?.checksums??[],this.homepage=r?.homepage??void 0,this.sourceInfo=r?.sourceInfo??void 0,this.licenseConcluded=r?.licenseConcluded??void 0,this.licenseInfoFromFiles=r?.licenseInfoFromFiles??[],this.licenseDeclared=r?.licenseDeclared??void 0,this.licenseComment=r?.licenseComment??void 0,this.copyrightText=r?.copyrightText??void 0,this.summary=r?.summary??void 0,this.description=r?.description??void 0,this.comment=r?.comment??void 0,this.externalReferences=r?.externalReferences??[],this.attributionTexts=r?.attributionTexts??[],this.primaryPackagePurpose=r?.primaryPackagePurpose??void 0,this.releaseDate=r?.releaseDate??void 0,this.builtDate=r?.builtDate??void 0,this.validUntilDate=r?.validUntilDate??void 0}static fromApi(e,r){return new W(e,{spdxId:r?.spdxId,version:r?.version,fileName:r?.fileName,downloadLocation:r?.downloadLocation&&k(r.downloadLocation),supplier:Dt(r?.supplier),originator:Dt(r?.originator),filesAnalyzed:r?.filesAnalyzed,verificationCode:r?.verificationCode,checksums:r?.checksums&&S.fromSpdxChecksums(r.checksums),homepage:r?.homepage&&k(r.homepage),sourceInfo:r?.sourceInfo,licenseConcluded:r?.licenseConcluded&&k(r.licenseConcluded),licenseInfoFromFiles:r?.licenseInfoFromFiles?.map(n=>k(n)),licenseDeclared:r?.licenseDeclared&&k(r.licenseDeclared),licenseComment:r?.licenseComment,copyrightText:r?.copyrightText&&k(r.copyrightText),summary:r?.summary,description:r?.description,comment:r?.comment,externalReferences:r?.externalReferences&&K.fromSpdxExternalPackageRefs(r.externalReferences),attributionTexts:r?.attributionTexts,primaryPackagePurpose:r?.primaryPackagePurpose?$r(r.primaryPackagePurpose):void 0,releaseDate:r?.releaseDate,builtDate:r?.builtDate,validUntilDate:r?.validUntilDate})}};var Q=class{documentRefId;documentUri;checksum;constructor(e,r,n){this.documentRefId=e,this.documentUri=r,this.checksum=n}static fromApi(e){return new Q(e.documentRefId,e.documentUri,S.fromSpdxChecksum({checksumValue:e.checksumValue,checksumAlgorithm:e.checksumAlgorithm}))}};function en(t){return"SPDX-"+(t??"2.3")}function tn(t){return"urn:"+(t.replace(/^[^A-Za-z0-9]+/,"").replace(/[^A-Za-z0-9-]/g,"-")??"document")+":"+G()}var Z=class{spdxVersion;dataLicense="CC0-1.0";spdxId;name;documentNamespace;externalDocumentRefs;licenseListVersion;creators;created;creatorComment;documentComment;constructor(e,r,n,i,o,s){this.spdxVersion=e,this.name=r,this.documentNamespace=n,this.creators=i,this.created=o,this.externalDocumentRefs=s?.externalDocumentRefs??[],this.creatorComment=s?.creatorComment??void 0,this.licenseListVersion=s?.licenseListVersion??void 0,this.documentComment=s?.documentComment??void 0,this.spdxId=s?.spdxId??"SPDXRef-DOCUMENT"}static fromApi(e,r){return new Z(en(r?.spdxVersion),e,r?.namespace??tn(e),r?.creators?E.fromSpdxActors(r.creators).concat(E.tools()):[E.tools()],r?.created??new Date,{...r,externalDocumentRefs:r?.externalDocumentRefs?r.externalDocumentRefs.map(n=>Q.fromApi(n)):void 0})}};var Pt=(c=>(c.OTHER="OTHER",c.DOCUMENTATION="DOCUMENTATION",c.IMAGE="IMAGE",c.VIDEO="VIDEO",c.ARCHIVE="ARCHIVE",c.SPDX="SPDX",c.APPLICATION="APPLICATION",c.SOURCE="SOURCE",c.BINARY="BINARY",c.TEXT="TEXT",c.AUDIO="AUDIO",c))(Pt||{});function rn(t){let e=Pt[t];if(!e)throw new Error("Invalid file type: "+t);return e}var $=class{name;spdxId;checksums;fileTypes;licenseConcluded;licenseInfoInFiles;licenseComment;copyrightText;comment;notice;contributors;attributionTexts;constructor(e,r,n){this.name=e,this.spdxId="SPDXRef-"+G(),this.checksums=r,this.fileTypes=n?.fileTypes??[],this.licenseConcluded=n?.licenseConcluded??void 0,this.licenseInfoInFiles=n?.licenseInfoInFiles??[],this.licenseComment=n?.licenseComment??void 0,this.copyrightText=n?.copyrightText??void 0,this.comment=n?.comment??void 0,this.notice=n?.notice??void 0,this.contributors=n?.contributors??[],this.attributionTexts=n?.attributionTexts??[]}static fromApi(e,r,n){return new $(e,S.fromSpdxChecksums(r),{spdxId:n?.spdxId??void 0,fileTypes:n?.fileTypes?n.fileTypes.map(i=>rn(i)):void 0,licenseConcluded:n?.licenseConcluded&&k(n.licenseConcluded),licenseInfoInFiles:n?.licenseInfoInFiles?.map(i=>k(i)),licenseComment:n?.licenseComment??void 0,copyrightText:n?.copyrightText&&k(n.copyrightText),comment:n?.comment??void 0,notice:n?.notice??void 0,contributors:n?.contributors??[],attributionTexts:n?.attributionTexts??[]})}};var ee=class extends X{static createDocument(e,r){let n=Z.fromApi(e,r);return new ee(n)}addPackage(e,r){let n=W.fromApi(e,r);return this.packages=this.packages.concat(n),n}addFile(e,r,n){let i=$.fromApi(e,r,n);return this.files=this.files.concat(i),i}addRelationship(e,r,n,i){let o=z.fromApi(e,r,n,i);return this.relationships=this.relationships.concat(o),this}validate(e=!0){let r=this.gatherValidationIssues();if(r.length>0){let n="Document is invalid: "+r.join(`
`);if(!e)throw new Error(n);console.error(n)}else console.log("Document is valid")}async write(e,r=!1){this.validate(r),await this.writeFile(e)}writeSync(e,r=!1){this.validate(r),this.writeFile(e).then(()=>{console.log("Wrote SBOM successfully: "+e)}).catch(n=>{console.error("Error writing sample SBOM: "+n)})}};function nn(t){return parseInt(t.split(".")[0])}function Et(t,e){let r=e?.spdxVersion;if(!r||nn(r)===2)return ee.createDocument(t,e);throw new Error("Unsupported SPDX version")}var Ot=g("clipanion");var C=g("@yarnpkg/core"),St=t=>{let e=new Set;for(let r of t.workspaces)r.manifest.devDependencies.forEach((n,i)=>{e.add(i)});return e},Ue=async(t,e=!1)=>{let r=new Map;if(!e){for(let u of t.workspaces)u.manifest.devDependencies.clear();let s=await C.Cache.find(t.configuration),a=new C.ThrowReport;await t.resolveEverything({report:a,cache:s})}let n=t.storedDescriptors.values(),i=C.miscUtils.sortMap(n,[s=>C.structUtils.stringifyIdent(s),s=>C.structUtils.isVirtualDescriptor(s)?"0":"1",s=>s.range]),o=new Set;for(let s of i.values()){let a=t.storedResolutions.get(s.descriptorHash);if(!a)continue;let u=t.storedPackages.get(a);if(!u)continue;let{descriptorHash:l}=C.structUtils.isVirtualDescriptor(s)?C.structUtils.devirtualizeDescriptor(s):s;o.has(l)||(o.add(l),r.set(s,u))}return r};var He={};le(He,{fs:()=>cn,getPackagePath:()=>on});var kt=g("@yarnpkg/plugin-pnp"),ye=g("@yarnpkg/core"),At=g("@yarnpkg/fslib");var te=()=>({os:[process.platform],cpu:[process.arch],libc:[]});var on=async(t,e)=>{if(an(t),!ye.structUtils.isPackageCompatible(e,te()))return null;let r=ye.structUtils.convertPackageToLocator(e),n={name:ye.structUtils.stringifyIdent(r),reference:r.reference},i=Ve.getPackageInformation(n);if(!i)return null;let{packageLocation:o}=i;return o},Ve,an=t=>{Ve||(Ve=module.require((0,kt.getPnpPath)(t).cjs))},cn=new At.VirtualFS({});var ae={};le(ae,{_getYarnStateAliases:()=>_t,fs:()=>un,getPackagePath:()=>dn});var L=g("@yarnpkg/core"),yt=g("@yarnpkg/parsers"),R=g("@yarnpkg/fslib");var dn=async(t,e)=>{if(await ln(t),!L.structUtils.isPackageCompatible(e,te()))return null;let r=L.structUtils.convertPackageToLocator(e),n=L.structUtils.stringifyLocator(r),i=Ce[n]||Ct[n];if(!i)return null;let o=i.locations[0];return o?R.ppath.join(t.cwd,o):t.cwd},Ce,Ct,ln=async t=>{if(!Ce){let e=R.ppath.join(t.configuration.projectCwd,R.Filename.nodeModules,".yarn-state.yml");Ce=(0,yt.parseSyml)(await R.xfs.readFilePromise(e,"utf8")),Ct=_t(Ce)}},un=R.xfs,_t=t=>Object.entries(t).reduce((e,[r,n])=>{if(!n.aliases)return e;let i=L.structUtils.parseLocator(r);for(let o of n.aliases){let s=L.structUtils.makeLocator(i,o),a=L.structUtils.stringifyLocator(s);e[a]=n}return e},{});var qe={};le(qe,{fs:()=>mn,getPackagePath:()=>fn});var ce=g("@yarnpkg/core"),w=g("@yarnpkg/fslib");var fn=async(t,e)=>{if(!ce.structUtils.isPackageCompatible(e,te()))return null;let r=ce.structUtils.convertPackageToLocator(e),n=ce.structUtils.slugifyLocator(r),i=ce.structUtils.stringifyIdent(r),o=t.tryWorkspaceByLocator(r);return o?o.cwd:w.ppath.join(t.configuration.projectCwd,w.Filename.nodeModules,".store",n,w.Filename.nodeModules,i)},mn=w.xfs;var Nt=t=>{switch(t){case"pnp":return He;case"node-modules":return ae;case"pnpm":return qe;default:throw new Error("Unsupported linker")}};var T=g("@yarnpkg/fslib"),pn="NOASSERTION",gn="SPDXRef-",hn="DEPENDS_ON",xn="DEV_DEPENDENCY_OF",Dn="DESCRIBES",In=".spdx.json",vt="(http:\\/\\/www\\.|https:\\/\\/www\\.|http:\\/\\/|https:\\/\\/|ssh:\\/\\/|git:\\/\\/|svn:\\/\\/|sftp:\\/\\/|ftp:\\/\\/)?([\\w\\-.!~*'()%;:&=+$,]+@)?[a-z0-9]+([\\-\\.]{1}[a-z0-9]+){0,100}\\.[a-z]{2,5}(:[0-9]{1,5})?(\\/.*)?",Pn="(git|hg|svn|bzr)",En="(git\\+git@[a-zA-Z0-9\\.\\-]+:[a-zA-Z0-9/\\\\.@\\-]+)",Sn="(bzr\\+lp:[a-zA-Z0-9\\.\\-]+)",kn="^((("+Pn+"\\+)?"+vt+")|"+En+"|"+Sn+")$",re=class extends _e.BaseCommand{async execute(){let e=await Ne.Configuration.find(this.context.cwd,this.context.plugins),{project:r,workspace:n}=await Ne.Project.find(e,this.context.cwd);if(!n)throw new _e.WorkspaceRequiredError(r.cwd,this.context.cwd);await r.restoreInstallState();let i=Et(n.manifest.name?.name??"spdx"),o=r.configuration.get("nodeLinker"),s;typeof o=="string"?s=Nt(o):s=ae;let a=new Set,u=St(r),l=await Ue(r,!0),h=[...l].flatMap(([,f])=>[...f.dependencies].flatMap(([,p])=>p.identHash)),c=An(l,h),d=yn(c,l,u);for(let[,f]of c.entries()){let p=await s.getPackagePath(r,f);if(p===null)continue;let I=JSON.parse(await s.fs.readFilePromise(T.ppath.join(p,T.Filename.manifest),"utf8")),{repository:A}=I,P=Be(A),m=O(f);a.has(m)||(a.add(m),i.addPackage(f.name,{downloadLocation:P,spdxId:m}))}for(let[,f]of d.entries()){if(!f)continue;let p=await s.getPackagePath(r,f);if(p===null)continue;let I=JSON.parse(await s.fs.readFilePromise(T.ppath.join(p,T.Filename.manifest),"utf8")),{repository:A}=I,P=Be(A),m=O(f);a.has(m)||(a.add(m),i.addPackage(f.name,{downloadLocation:P,spdxId:m}))}console.log("EXISTING IDS: ",a);for(let[,f]of c.entries()){let p=O(f);console.log("CURRENT ID: ",p);for(let[I,A]of f.dependencies.entries()){if(!u.has(I))continue;let P=r.storedResolutions.get(A.descriptorHash);if(!P)continue;let m=r.storedPackages.get(P);!m||(console.log("DEPENDENCY ID: ",O(m)),!(!a.has(p)||!a.has(O(m)))&&i.addRelationship(O(m),p,xn))}}let ne=await Ue(r),Oe=[...ne].flatMap(([,f])=>[...f.dependencies].flatMap(([,p])=>p.identHash));for(let[,f]of ne.entries()){let p=await s.getPackagePath(r,f);if(p===null)continue;let I=JSON.parse(await s.fs.readFilePromise(T.ppath.join(p,T.Filename.manifest),"utf8")),{repository:A}=I,P=Be(A),m=O(f);a.has(m)||(a.add(m),i.addPackage(f.name,{downloadLocation:P,spdxId:m}))}for(let[f,p]of ne.entries()){let I=O(p);Rt(Oe,f)&&a.has(I)&&i.addRelationship(i,I,Dn);for(let[,A]of p.dependencies.entries()){let P=r.storedResolutions.get(A.descriptorHash);if(!P)continue;let m=r.storedPackages.get(P);!m||!a.has(I)||!a.has(O(m))||i.addRelationship(I,O(m),hn)}}i.writeSync((n.manifest.name?.name??"")+In)}};re.paths=[["spdx"]],re.usage=Ot.Command.Usage({description:"Generate SPDX document for the project",details:`
        This command generates an SPDX document for the project. The document will be placed in the root of the project.`,examples:[["Generate SPDX document","$0 spdx"]]});function An(t,e){let r=new Map;for(let[n,i]of t.entries())Rt(e,n)&&r.set(n,i);return r}function Rt(t,e){return!t.includes(e.identHash)}function yn(t,e,r){let n=new Map;for(let[,i]of t.entries())for(let[o,s]of i.dependencies.entries())r.has(o)&&n.set(s,e.get(s));return n}function Be(t){return t&&typeof t=="object"&&Cn(t.url)?t.url:pn}function Cn(t){return new RegExp(vt).test(t)&&new RegExp(kn).test(t)}function O(t){let e=t.name.replace(/^@/,"").replace(/_/g,"-"),r=t.version.replace(/\//g,".").replace(/_/g,"-");return gn+e+"-"+r}var _n={commands:[re]},Nn=_n;return Yt(On);})();
return plugin;
}
};
